name: Python License Check

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  license-check:
    runs-on: ubuntu-24.04

    steps:
      - uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0

      - name: Create GitHub App Token able to read all CVector repos
        id: get-token
        uses: actions/create-github-app-token@v2
        with:
          app-id: ${{ inputs.app-id }}
          private-key: ${{ inputs.app-private-key }}
          owner: ${{ github.repository_owner }}
          permission-contents: read

      - name: Set up uv
        uses: astral-sh/setup-uv@5a7eac68fb9809dea845d802897dc5c723910fa3 # v7.1.3

      - name: Find Python dependency files
        id: find-deps
        run: |
          files=$(find . -name 'pyproject.toml' -o -name 'requirements.txt' | paste -sd ',' -)
          echo "paths=$files" >> "$GITHUB_OUTPUT"

      - name: Run license check
        if: steps.find-deps.outputs.paths != ''
        run: uvx licensecheck@2025.1.0 --requirements-paths "${{ steps.find-deps.outputs.paths }}" --zero
